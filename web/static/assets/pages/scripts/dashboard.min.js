var pathArray=location.href.split("/");var protocol=pathArray[0];var host=pathArray[2];var url=protocol+"//"+host;var base_IP=url;if($("#server_url_field").val()){base_IP=$("#server_url_field").val()}function post_submit(){var a=new FormData();a.append("photo",$("#invoice")[0].files[0]);a.append("json",JSON.stringify({note:$("#note").val().replace(/,/g,""),}));jQuery.ajax({url:base_IP+"/api/submit_post/",type:"POST",cache:false,contentType:false,processData:false,enctype:"multipart/form-data",headers:{USERTOKEN:Cookies.get("user_token")},data:a,error:function(e,b,c,d){alert("خطا")},success:function(b){alert("ثبت شد");location.reload()}}).always(function(c,b){})}function add_wallet(){var a=new FormData();a.append("json",JSON.stringify({count:$("#wallet_count").val().replace(/,/g,""),description:"",isincome:1,payment_method:"initial",Tr_group:$("#Tr_group_reg").val(),}));jQuery.ajax({url:base_IP+"/api/submit_tr/",type:"POST",cache:false,contentType:false,processData:false,enctype:"multipart/form-data",headers:{USERTOKEN:Cookies.get("user_token")},data:a,error:function(e,b,c,d){alert("خطا")},success:function(b){alert("ثبت شد");location.reload()}}).always(function(c,b){})}function posts_list(){jQuery.ajax({url:base_IP+"/api/user_posts_list/",type:"POST",dataType:"json",headers:{USERTOKEN:Cookies.get("user_token"),"Content-type":"application/json"},data:{},error:function(d,a,b,c){alert("خطا")},success:function(a){$("#list").html("");for(var b in a.note_list){(a.note_list[b].is_like)?classname="red_like":classname="";$("#list").append('<div class="card"><div class="card-header"><h4 class="card-title">'+a.note_list[b].user_name+'</h4></div><img src="/img/'+a.note_list[b].post_photo+'" class="post-image" alt="note_image" style="width:100%">                 <div class="text_p"><p class="card-text">'+a.note_list[b].note+'</p> </div><div class="card-footer">                 <a data-toggle="liking" class="'+classname+'"  data-code="'+a.note_list[b].tracking_code+'"><i class="fa fa-heart">                 </i></a><a href="#" class="card_num_likes">'+a.note_list[b].likes+"</a></div></div>")}$(".card-footer a").on("click",function(){if($(this).data("toggle")=="liking"){if($(this).hasClass("red_like")){jQuery.ajax({url:base_IP+"/api/like_post/",type:"POST",context:this,cache:false,contentType:false,processData:false,enctype:"multipart/form-data",headers:{USERTOKEN:Cookies.get("user_token")},data:JSON.stringify({tracking_code:$(this).data("code"),type:"dislike"}),error:function(f,c,d,e){alert("خطا")},success:function(c){$(this).removeClass("red_like");$(this).closest(".card-footer").find(".card_num_likes").html(Number($(this).closest(".card-footer").find(".card_num_likes").html())-1)}}).always(function(d,c){})}else{jQuery.ajax({url:base_IP+"/api/like_post/",type:"POST",context:this,cache:false,contentType:false,processData:false,enctype:"multipart/form-data",headers:{USERTOKEN:Cookies.get("user_token")},data:JSON.stringify({tracking_code:$(this).data("code")}),error:function(f,c,d,e){alert("خطا")},success:function(c){$(this).addClass("red_like");$(this).closest(".card-footer").find(".card_num_likes").html(Number($(this).closest(".card-footer").find(".card_num_likes").html())+1)}}).always(function(d,c){})}}else{}});$(".card-title").on("click",function(){jQuery.ajax({url:base_IP+"/api/users_page/",type:"POST",context:this,cache:false,contentType:false,processData:false,enctype:"multipart/form-data",headers:{USERTOKEN:Cookies.get("user_token")},data:JSON.stringify({user_name:$(this).html(),}),error:function(f,c,d,e){alert("خطا")},success:function(c){$("#usernamePage").html(c.user_data.user_name);$("#postsPage").html(c.user_data.posts);$("#postFollowers").html(c.user_data.followers);$("#postFollowing").html(c.user_data.following);$("#btn-req").data("username",c.user_data.user_name);if(c.user_data.is_follow){$("#btn-req").removeClass("btn");$("#btn-req").html("دنبال شده")}else{$("#btn-req").addClass("btn");$("#btn-req").html("دنبال کردن")}$("#pageModal .row").html("");for(var d in c.note_list){$("#pageModal .row").append('<div class="card explore col-xs-4"><a data-toggle="" class="pageImage"                                data-code="'+c.note_list[d].tracking_code+'"><img src="/img/'+c.note_list[d].post_photo+'"                               class="card-image" alt="note_image" style="width:100%"></a> </div>')}$("#pageModal").modal()}}).always(function(d,c){})})}}).always(function(b,a){})}function user_profile(){jQuery.ajax({url:base_IP+"/api/user_profile/",type:"POST",context:this,cache:false,contentType:false,processData:false,enctype:"multipart/form-data",headers:{USERTOKEN:Cookies.get("user_token")},data:{},error:function(d,a,b,c){alert("خطا")},success:function(a){$("#usernameProfile").html(a.user_data.user_name);$("#postsUser").html(a.user_data.posts);$("#userFollowers").html(a.user_data.followers);$("#userFollowing").html(a.user_data.following);$("#btn-req").data("username",a.user_data.user_name);$("#profile .row").html("");for(var b in a.note_list){$("#profile .row").append('<div class="card explore col-xs-4"><a data-toggle="" class="pageImage"            data-code="'+a.note_list[b].tracking_code+'"><img src="/img/'+a.note_list[b].post_photo+'"           class="card-image" alt="note_image" style="width:100%"></a> </div>')}}}).always(function(b,a){})}function explore_list(){jQuery.ajax({url:base_IP+"/api/explore_posts_list/",type:"POST",dataType:"json",headers:{USERTOKEN:Cookies.get("user_token"),"Content-type":"application/json"},data:{},error:function(d,a,b,c){alert("خطا")},success:function(a){$("#explore_list .row").html("");for(var b in a.note_list){$("#explore_list .row").append('<div class="card explore col-xs-4"><a data-toggle="" class=""                  data-code="'+a.note_list[b].tracking_code+'"><img src="/img/'+a.note_list[b].post_photo+'"                 class="card-image" alt="note_image" style="width:100%"></a> </div>')}$(".card.explore a").click(function(){jQuery.ajax({url:base_IP+"/api/post_details/",type:"POST",dataType:"json",headers:{USERTOKEN:Cookies.get("user_token"),"Content-type":"application/json"},data:JSON.stringify({tracking_code:$(this).data("code"),}),error:function(f,c,d,e){alert("خطا")},success:function(c){$("#post_username").html(c.post_details.user_name);$("#post_note").html(c.post_details.note);$("#post_num_likes").html(c.post_details.likes);(c.post_details.is_like)?$("#post_like").addClass("red_like"):$("#post_like").removeClass("red_like");$("#post_like").data("code",c.post_details.tracking_code);$("#post_image").attr("src","/img/"+c.post_details.post_photo);$("#postModal").modal()}}).always(function(d,c){})})}}).always(function(b,a){})}function logout(){jQuery.ajax({url:base_IP+"/api/user_logout/",type:"POST",dataType:"json",headers:{USERTOKEN:Cookies.get("user_token"),"Content-type":"application/json"},data:{},error:function(d,a,b,c){alert("خطا")},success:function(a){document.cookie="user_token=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";window.location.replace("/")}}).always(function(b,a){})}jQuery(document).ready(function(){explore_list();posts_list();user_profile();$("#post_submit_btn").click(function(){post_submit()});$("#register-btn").click(function(){$(".login-form").hide();$(".register-form").show()});$("#radioBtn a").on("click",function(){var b=$(this).data("title");var a=$(this).data("toggle");$("#"+a).prop("value",b);if(b=="0"){$(".costing").show();$(".transfer").hide()}else{if(b=="1"){$(".costing").hide();$(".transfer").hide()}else{$(".costing").hide();$(".transfer").show()}}$('a[data-toggle="'+a+'"]').not('[data-title="'+b+'"]').removeClass("active").addClass("notActive");$('a[data-toggle="'+a+'"][data-title="'+b+'"]').removeClass("notActive").addClass("active")});$("#radioBtn_out a").on("click",function(){var b=$(this).data("title");var a=$(this).data("toggle");$("#"+a).prop("value",b);$('a[data-toggle="'+a+'"]').not('[data-title="'+b+'"]').removeClass("active").addClass("notActive");$('a[data-toggle="'+a+'"][data-title="'+b+'"]').removeClass("notActive").addClass("active")});$("#date a").on("click",function(){var b=$(this).data("title");var a=$(this).data("toggle");$("#"+a).prop("value",b);if(b=="1"){$(".date-picker").show()}else{$(".date-picker").hide()}$('a[data-toggle="'+a+'"]').not('[data-title="'+b+'"]').removeClass("active").addClass("notActive");$('a[data-toggle="'+a+'"][data-title="'+b+'"]').removeClass("notActive").addClass("active")});$("#icon_bar a").on("click",function(){var b=$(this).data("title");var a=$(this).data("toggle");$(".page-title span").html(a);if(b=="explore"){$("#explore_list").show();$("#addtransaction").hide();$("#list").hide();$("#profile").hide()}else{if(b=="profile"){$("#explore_list").hide();$("#addtransaction").hide();$("#list").hide();$("#profile").show()}else{if(b=="list"){$("#explore_list").hide();$("#addtransaction").hide();$("#list").show();$("#profile").hide()}else{$("#explore_list").hide();$("#profile").hide();$("#list").hide();$("#addtransaction").show()}}}});$("#logout_btn").click(function(){logout()});$("#btn-req").click(function(){jQuery.ajax({url:base_IP+"/api/following/",type:"POST",dataType:"json",headers:{USERTOKEN:Cookies.get("user_token"),"Content-type":"application/json"},data:JSON.stringify({user_name:$(this).data("username"),type:(!$("#btn-req").hasClass("btn"))?"unfollow":"follow"}),error:function(d,a,b,c){alert("خطا")},success:function(a){if(!$("#btn-req").hasClass("btn")){$("#btn-req").addClass("btn");$("#postFollowers").html(parseInt($("#postFollowers").html())-1);$("#btn-req").html("دنبال کردن")}else{$("#btn-req").removeClass("btn");$("#postFollowers").html(parseInt($("#postFollowers").html())+1);$("#btn-req").html("دنبال شده")}}}).always(function(b,a){})})});